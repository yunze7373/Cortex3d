services:
  instantmesh:
    build:
      context: .
      dockerfile: Dockerfile
    image: cortex3d-instantmesh:latest
    container_name: cortex3d-dev
    working_dir: /workspace
    volumes:
      - ./:/workspace
      - hf-cache:/root/.cache/huggingface
    shm_size: "8gb"
    stdin_open: true
    tty: true
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [gpu]

  trellis:
    build:
      context: .
      dockerfile: Dockerfile.trellis
    image: cortex3d-trellis:latest
    container_name: cortex3d-trellis
    working_dir: /workspace
    volumes:
      - ./:/workspace
      - hf-cache:/root/.cache/huggingface
    shm_size: "16gb"
    stdin_open: true
    tty: true
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [gpu]

  hunyuan3d:
    build:
      context: .
      dockerfile: Dockerfile.hunyuan3d
    image: cortex3d-hunyuan3d:latest
    container_name: cortex3d-hunyuan3d
    working_dir: /workspace
    volumes:
      - ./:/workspace
      - hf-cache:/root/.cache/huggingface
    shm_size: "16gb"
    stdin_open: true
    tty: true
    environment:
      - HUNYUAN3D_VERSION=2.0
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [gpu]

  hunyuan3d-2.1:
    build:
      context: .
      dockerfile: Dockerfile.hunyuan3d-2.1
    image: cortex3d-hunyuan3d-2.1:latest
    container_name: cortex3d-hunyuan3d-2.1
    working_dir: /workspace
    volumes:
      - ./:/workspace
      - hf-cache:/root/.cache/huggingface
    shm_size: "16gb"
    stdin_open: true
    tty: true
    environment:
      - HUNYUAN3D_VERSION=2.1
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [gpu]

  trellis2:
    build:
      context: .
      dockerfile: Dockerfile.trellis2
    image: cortex3d-trellis2:latest
    container_name: cortex3d-trellis2
    working_dir: /workspace
    volumes:
      - ./:/workspace
      - hf-cache:/root/.cache/huggingface
    shm_size: "24gb"
    stdin_open: true
    tty: true
    environment:
      - PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True
      - OPENCV_IO_ENABLE_OPENEXR=1
      - TORCH_CUDA_ARCH_LIST=8.6;8.9;9.0
      - CUDA_VISIBLE_DEVICES=0
      - ATTN_BACKEND=flash-attn
      - SPCONV_ALGO=native
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [gpu]

  hunyuan3d-omni:
    build:
      context: .
      dockerfile: Dockerfile.hunyuan3d-omni
    image: cortex3d-hunyuan3d-omni:latest
    container_name: cortex3d-hunyuan3d-omni
    working_dir: /workspace
    volumes:
      - ./:/workspace
      - hf-cache:/root/.cache/huggingface
    shm_size: "16gb"
    stdin_open: true
    tty: true
    environment:
      - HUNYUAN3D_VERSION=omni
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [gpu]

volumes:
  hf-cache:

